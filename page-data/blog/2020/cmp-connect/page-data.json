{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/2020/cmp-connect/","result":{"data":{"site":{"siteMetadata":{"title":"Roman Klimenko"}},"markdownRemark":{"id":"717a8d55-e489-531c-aaf7-dcf3d3e2636c","excerpt":"Sitecore Connect™ for Sitecore CMP version 2.0.0 was released this week. It is a module that syncs content created in the Sitecore Content Hub to Sitecore XP…","html":"<p><a href=\"https://dev.sitecore.net/Downloads/Sitecore_Connect_for_Sitecore_CMP/20/Sitecore_Connect_for_Sitecore_CMP_200.aspx\">Sitecore Connect™ for Sitecore CMP version 2.0.0</a> was released this week. It is a module that syncs content created in the Sitecore Content Hub to Sitecore XP.</p>\n<p>The module has excellent documentation. However, in this post, I'd like to shed some light on the technical aspects of the module.</p>\n<p>In Sitecore XP, the building blocks are called items. In Content Hub, there are entities. The entities have fields and relations.</p>\n<p>Say, we have created a blog post in English (<code class=\"language-text\">en-US</code>) in Content Hub. In this case, Content Hub, we have an entity with properties like <code class=\"language-text\">Title</code>, <code class=\"language-text\">Body</code>, etc. A relation named <code class=\"language-text\">ContentTypeToContent</code> from a <code class=\"language-text\">Blog</code> entity to our entity makes our entity a blog post.</p>\n<p>And a relation named <code class=\"language-text\">LocalizationToContent</code> from <code class=\"language-text\">en-US</code> entity to our entity tells us that our blog post is in American English.</p>\n<p>Now, if we localize our blog post, say, to <code class=\"language-text\">nl-BE</code>, Content Hub creates another blog post entity and links it via the <code class=\"language-text\">LocalizationToContent</code> relation to <code class=\"language-text\">nl-BE</code> language entity. There's also a <code class=\"language-text\">ContentToContentLocalization</code> relation from our English blog post to a localized Belgian one.</p>\n<img src=\"entity.png\" class=\"img-fluid\" />\n<p>Now, let's see how Sitecore Connect™ for Sitecore CMP 2.0.0 pulls the entities to Sitecore XP items:</p>\n<p>When an entity is published, a Content Hub trigger executes an action that pushes a message to a topic (<code class=\"language-text\">hub_out</code>) in Azure Service bus. The message contains the <code class=\"language-text\">entity_id</code>, and other systems can subscribe to the topic to know about the new changes.</p>\n<p>On the Sitecore XP side (CM), a subscription client listens to the new messages in the <code class=\"language-text\">hub_out</code>.</p>\n<p>Then a new message appears, the <code class=\"language-text\">cmp.importEntity</code> pipeline starts.</p>\n<p>The <code class=\"language-text\">cmp.importEntity</code> pipeline runs three following processors:</p>\n<p><code class=\"language-text\">FetchEntity</code> processor:</p>\n<ol>\n<li>Gets the <code class=\"language-text\">entity_id</code> from the Service Bus message.</li>\n<li>Gets the entity from Content Hub.</li>\n<li>Resolves the content language by getting the <code class=\"language-text\">LocalizationToContent</code> relation.</li>\n<li>Resolves the localization parent (if it exists) by getting the <code class=\"language-text\">ContentToContentLocalization</code>.</li>\n</ol>\n<p><code class=\"language-text\">EnsureItem</code> processor:</p>\n<ol>\n<li>Tries to get an item that corresponds to the entity.</li>\n<li>It searches for an item in a configured Items Bucket where the <code class=\"language-text\">Entity Identifier</code> field is equal to the identifier of the entity (if there is no <code class=\"language-text\">ContentToContentLocalization</code> parent entity) or equal to the <code class=\"language-text\">ContentToContentLocalization</code> parent entity.</li>\n<li>Sets the <code class=\"language-text\">Entity Identifier</code> field of the new item.</li>\n<li>If there's no such an item, the processor creates a new item in the language from the <code class=\"language-text\">LocalizationToContent</code> relation. Otherwise, it uses the default language setting.</li>\n</ol>\n<p><code class=\"language-text\">SaveFieldValues</code> processor:</p>\n<ol>\n<li>Saves the item fields that configured for synchronization.</li>\n<li>After the <code class=\"language-text\">cmp.importEntity</code> finishes, the module pushes a message to another topic - <code class=\"language-text\">hub_in</code>. This message contains things like incoming message id, item id, entity id, exception, if any.</li>\n</ol>\n<p>Content Hub consumes the message and knows the status of the entity synchronization.</p>\n<img src=\"topology.png\" class=\"img-fluid\" />","fields":{"slug":"/blog/2020/cmp-connect/"},"frontmatter":{"title":"Sitecore Connect™ for Sitecore CMP 2.0.0","date":"January 21, 2020","tags":["sitecore","content-hub"],"description":null}},"previous":{"fields":{"slug":"/blog/2019/ratings/"},"frontmatter":{"title":"Communities and ratings"}},"next":{"fields":{"slug":"/blog/2020/sitecorosaur/"},"frontmatter":{"title":"Sitecorosaur"}}},"pageContext":{"id":"717a8d55-e489-531c-aaf7-dcf3d3e2636c","previousPostId":"ced4b3fa-239f-5adc-9f52-a3c0e72dd099","nextPostId":"28cf7d0f-5536-5648-8997-8bd7700c974b"}},"staticQueryHashes":["2841359383"]}